CREATE OR REPLACE FUNCTION calculate_gpra_date(
    exam_analysis_finalized DATE,
    draft_to_prudential DATE
)
RETURNS DATE AS $$
DECLARE
    result_date DATE;
BEGIN
    -- Check if Exam Analysis Finalized is not empty and Draft to Prudential is empty
    IF exam_analysis_finalized IS NOT NULL AND draft_to_prudential IS NULL THEN
        -- Use our workday function to add 45 workdays
        result_date := workday(exam_analysis_finalized, 45);
    -- Check if both Exam Analysis Finalized and Draft to Prudential are not empty
    ELSIF exam_analysis_finalized IS NOT NULL AND draft_to_prudential IS NOT NULL THEN
        -- Return NULL (empty string in Excel becomes NULL in PostgreSQL)
        result_date := NULL;
    ELSE
        -- For any other case, return NULL
        result_date := NULL;
    END IF;

    RETURN result_date;
END;
$$ LANGUAGE plpgsql;
