SELECT 
    consumer_np, 
    archive_month, 
    credit_am, 
    balance_am, 
    trade_nb,
    LAG(credit_am) OVER (PARTITION BY consumer_np ORDER BY archive_month, trade_nb) AS prev_credit_am,
    LAG(balance_am) OVER (PARTITION BY consumer_np ORDER BY archive_month, trade_nb) AS prev_balance_am,
    LAG(trade_nb) OVER (PARTITION BY consumer_np ORDER BY archive_month, trade_nb) AS prev_trade_nb
FROM 
    prod.ccip.tip
WHERE 
    archive_month = 2023301 
    AND consumer_nb = '123456'
ORDER BY 
    consumer_nb, 
    archive_month, 
    trade_nb;
