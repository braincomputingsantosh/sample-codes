# Reload the file and read the specified worksheet "Layout Clean"
file_path = '/mnt/data/file_layout_2020_DHC-National.xlsx'
worksheet_name = 'Layout Clean'
df_layout_clean = pd.read_excel(file_path, sheet_name=worksheet_name)

# Generate SQL CREATE TABLE script
def generate_create_table_script(df, table_name):
    dtype_map = {
        'object': 'TEXT',
        'int64': 'BIGINT',
        'float64': 'DOUBLE PRECISION',
        'datetime64[ns]': 'TIMESTAMP',
        'bool': 'BOOLEAN'
    }

    script = f"CREATE TABLE {table_name} (\n"
    for column in df.columns:
        pandas_dtype = str(df[column].dtype)
        sql_dtype = dtype_map.get(pandas_dtype, 'TEXT')
        script += f"    \"{column}\" {sql_dtype},\n"
    script = script[:-2] + "\n);"

    return script

# Generate SQL INSERT INTO script
def generate_insert_into_script(df, table_name):
    insert_script = f"INSERT INTO {table_name} VALUES\n"
    rows = []

    for _, row in df.iterrows():
        values = []
        for value in row:
            if pd.isna(value):
                values.append('NULL')
            elif isinstance(value, str):
                value = value.replace("'", "''")
                values.append(f"'{value}'")
            else:
                values.append(str(value))
        row_str = ", ".join(values)
        rows.append(f"({row_str})")

    insert_script += ",\n".join(rows) + ";"
    return insert_script

# Table name for the "Layout Clean" sheet
table_name_layout_clean = "Census_2020_DHC.dbo.layoutDHC2020_LayoutClean"

# Generate the scripts
create_table_script_layout_clean = generate_create_table_script(df_layout_clean, table_name_layout_clean)
insert_script_layout_clean = generate_insert_into_script(df_layout_clean, table_name_layout_clean)

# Due to length, save the insert script to a file
insert_script_path_layout_clean = '/mnt/data/insert_layoutClean2020_Geo.sql'
with open(insert_script_path_layout_clean, 'w') as file:
    file.write(insert_script_layout_clean)

(create_table_script_layout_clean, insert_script_path_layout_clean)
