# Ensure the schema matches the target table
            for field in target_schema.fields:
                if field.name not in unique_metadata.columns:
                    unique_metadata = unique_metadata.withColumn(field.name, lit(None).cast(field.dataType))
            
            # Select only the columns in the target schema and in the correct order
            unique_metadata = unique_metadata.select(*[col(field.name).cast(field.dataType) for field in target_schema.fields])
            
