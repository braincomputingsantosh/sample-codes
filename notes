import requests
import json
from databricks_cli.sdk.api_client import ApiClient

def get_current_user_groups():
    # Initialize the Databricks API client
    api_client = ApiClient()

    # Get the current user's information
    current_user = api_client.perform_query('GET', '/preview/scim/v2/Me')
    user_id = current_user['id']

    # Get the list of groups
    groups = api_client.perform_query('GET', '/preview/scim/v2/Groups')

    # Check which groups the user belongs to
    user_groups = []
    for group in groups.get('Resources', []):
        for member in group.get('members', []):
            if member['value'] == user_id:
                user_groups.append(group['displayName'])

    return user_groups

def main():
    try:
        user_groups = get_current_user_groups()
        if user_groups:
            print("You belong to the following Databricks groups:")
            for group in user_groups:
                print(f"- {group}")
        else:
            print("You don't belong to any Databricks groups.")
    except Exception as e:
        print(f"An error occurred: {str(e)}")
        print("Make sure you have set up your Databricks CLI configuration correctly.")

if __name__ == "__main__":
    main()
