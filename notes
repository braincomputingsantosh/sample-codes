-- Assuming temp_event_ids has been populated as per the logic in the function
WITH formatted_event_ids AS (
    SELECT DISTINCT 'EID-' || LPAD(unnest(string_to_array('11521,2521,5214,521', ',')), 8, '0') AS event_id
),
simulated_update AS (
    SELECT 
        e.Event_ID,
        CASE
            WHEN e.Calendared IS NULL OR e.Calendared = '' THEN
                CASE
                    WHEN e.Event_ID IN (SELECT event_id FROM formatted_event_ids) THEN 'Yes'
                    ELSE 'No'
                END
            ELSE e.Calendared
        END AS proposed_est_calendared
    FROM public.exams e
)
SELECT * FROM simulated_update;
