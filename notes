WITH event_ids AS (
    SELECT unnest(string_to_array('event1,event2,event3', ',')) AS event_id
),
calculated AS (
    SELECT
        e.*,
        CASE
            WHEN e.Calendared IS NULL OR e.Calendared = '' THEN
                CASE
                    WHEN e.Event_ID = ANY (SELECT event_id FROM event_ids) THEN 'Yes'
                    ELSE 'No'
                END
            ELSE e.Calendared
        END AS est_calendared_proposed
    FROM events e
)
SELECT * FROM calculated;
