import paramiko
from databricks.sdk.runtime import *

def download_from_sftp(sftp_host, sftp_port, sftp_username, sftp_password, remote_path, local_path):
    # Create an SSH client
    ssh = paramiko.SSHClient()
    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
    
    try:
        # Connect to the SFTP server
        ssh.connect(sftp_host, port=sftp_port, username=sftp_username, password=sftp_password)
        
        # Create an SFTP client
        sftp = ssh.open_sftp()
        
        # Download the file
        sftp.get(remote_path, local_path)
        
        print(f"File downloaded successfully: {local_path}")
    
    except Exception as e:
        print(f"An error occurred: {str(e)}")
    
    finally:
        # Close the SFTP and SSH connections
        if sftp:
            sftp.close()
        if ssh:
            ssh.close()

# SFTP server details
sftp_host = "your_sftp_host"
sftp_port = 22  # Default SFTP port
sftp_username = "your_username"
sftp_password = "your_password"

# File paths
remote_file_path = "/path/to/remote/file.txt"
volume_name = "your_volume_name"
local_file_path = f"/dbfs/mnt/{volume_name}/downloaded_file.txt"

# Call the function to download the file
download_from_sftp(sftp_host, sftp_port, sftp_username, sftp_password, remote_file_path, local_file_path)
