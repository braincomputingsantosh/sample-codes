CREATE OR REPLACE PROCEDURE update_est_calendared(event_id_list TEXT)
LANGUAGE plpgsql
AS $$
DECLARE
    event_ids TEXT[];
BEGIN
    -- Convert comma-separated list to array and format each event_id
    event_ids := ARRAY(
        SELECT 'EID-' || LPAD(unnest(string_to_array(event_id_list, ',')), 8, '0')
    );
    
    -- Perform the update logic on public.exams
    UPDATE public.exams
    SET est_calendared = CASE
        WHEN Calendared IS NULL OR Calendared = '' THEN
            CASE
                WHEN Event_ID = ANY (event_ids) THEN 'Yes'
                ELSE 'No'
            END
        ELSE Calendared
    END;
END;
$$;
